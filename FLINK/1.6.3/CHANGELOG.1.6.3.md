
<!---
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-->
# Apache Flink Changelog

## Release 1.6.3 - 2018-12-22



### IMPROVEMENTS:

| JIRA | Summary | Priority | Component | Reporter | Contributor |
|:---- |:---- | :--- |:---- |:---- |:---- |
| [FLINK-10608](https://issues.apache.org/jira/browse/FLINK-10608) | Add avro files generated by datastream-allround-test to RAT exclusions |  Major | Build System | Chesnay Schepler | Chesnay Schepler |
| [FLINK-10614](https://issues.apache.org/jira/browse/FLINK-10614) | Update test\_batch\_allround.sh e2e to new testing infrastructure |  Minor | Tests | Till Rohrmann | Till Rohrmann |
| [FLINK-10637](https://issues.apache.org/jira/browse/FLINK-10637) | Start MiniCluster with random REST port |  Critical | Tests | Till Rohrmann | Till Rohrmann |
| [FLINK-10613](https://issues.apache.org/jira/browse/FLINK-10613) | Remove logger casts in HBaseConnectorITCase |  Critical | Tests | Chesnay Schepler | Chesnay Schepler |
| [FLINK-10692](https://issues.apache.org/jira/browse/FLINK-10692) | Harden Confluent schema E2E test |  Major | Test Infrastructure | Till Rohrmann | Till Rohrmann |
| [FLINK-10353](https://issues.apache.org/jira/browse/FLINK-10353) | Restoring a KafkaProducer with Semantic.EXACTLY\_ONCE from a savepoint written with Semantic.AT\_LEAST\_ONCE fails with NPE |  Critical | Connectors / Kafka | Konstantin Knauf | Stefan Richter |
| [FLINK-10883](https://issues.apache.org/jira/browse/FLINK-10883) | Submitting a jobs without enough slots times out due to a unspecified timeout |  Major | Runtime / Coordination | Chesnay Schepler | Till Rohrmann |
| [FLINK-10906](https://issues.apache.org/jira/browse/FLINK-10906) | docker-entrypoint.sh logs credentails during startup |  Critical | flink-docker | Konstantin Knauf | Till Rohrmann |
| [FLINK-10916](https://issues.apache.org/jira/browse/FLINK-10916) | Include duplicated user-specified uid into error message |  Trivial | API / DataStream | Kirill Mikheev |  |
| [FLINK-10678](https://issues.apache.org/jira/browse/FLINK-10678) | Add a switch to run\_test to configure if logs should be checked for errors/excepions |  Blocker | Test Infrastructure | Dawid Wysakowicz | Dawid Wysakowicz |
| [FLINK-11005](https://issues.apache.org/jira/browse/FLINK-11005) | Define flink-sql-client uber-jar dependencies via artifactSet |  Major | Build System | Till Rohrmann | Till Rohrmann |
| [FLINK-4173](https://issues.apache.org/jira/browse/FLINK-4173) | Replace maven-assembly-plugin by maven-shade-plugin in flink-metrics |  Minor | Build System, Runtime / Metrics | Till Rohrmann | Chesnay Schepler |
| [FLINK-10951](https://issues.apache.org/jira/browse/FLINK-10951) | Disable enforcing of YARN container virtual memory limits in tests |  Critical | Tests | Gary Yao | Gary Yao |
| [FLINK-11029](https://issues.apache.org/jira/browse/FLINK-11029) | Incorrect parameter in Working with state doc |  Minor | Documentation | Yangze Guo | Yangze Guo |
| [FLINK-10359](https://issues.apache.org/jira/browse/FLINK-10359) | Scala example in DataSet docs is broken |  Major | Documentation | Fabian Hueske | vinoyang |
| [FLINK-10566](https://issues.apache.org/jira/browse/FLINK-10566) | Flink Planning is exponential in the number of stages |  Major | API / DataSet | Robert Bradshaw | Maximilian Michels |


### BUG FIXES:

| JIRA | Summary | Priority | Component | Reporter | Contributor |
|:---- |:---- | :--- |:---- |:---- |:---- |
| [FLINK-10567](https://issues.apache.org/jira/browse/FLINK-10567) | Lost serialize fields when ttl state store with the mutable serializer |  Major | Runtime / State Backends | Aitozi | Aitozi |
| [FLINK-9878](https://issues.apache.org/jira/browse/FLINK-9878) | IO worker threads BLOCKED on SSL Session Cache while CMS full gc |  Major | Runtime / Network | Nico Kruber | Nico Kruber |
| [FLINK-10491](https://issues.apache.org/jira/browse/FLINK-10491) | Deadlock during spilling data in SpillableSubpartition |  Critical | Runtime / Network | Piotr Nowojski | Zhijiang |
| [FLINK-10425](https://issues.apache.org/jira/browse/FLINK-10425) | taskmanager.host is not respected |  Major | Runtime / Coordination | Andrew Kowpak | vinoyang |
| [FLINK-10570](https://issues.apache.org/jira/browse/FLINK-10570) | State grows unbounded when "within" constraint not applied |  Major | Library / CEP | Thomas Wozniakowski | Dawid Wysakowicz |
| [FLINK-10663](https://issues.apache.org/jira/browse/FLINK-10663) | Closing StreamingFileSink can cause NPE |  Critical | Connectors / Common, Connectors / FileSystem | Gary Yao | Gary Yao |
| [FLINK-10166](https://issues.apache.org/jira/browse/FLINK-10166) | Dependency problems when executing SQL query in sql-client |  Blocker | Table SQL / API, Table SQL / Client | Dawid Wysakowicz | Timo Walther |
| [FLINK-10690](https://issues.apache.org/jira/browse/FLINK-10690) | Tests leak resources via Files.list |  Major | Tests | Chesnay Schepler | Chesnay Schepler |
| [FLINK-10693](https://issues.apache.org/jira/browse/FLINK-10693) | Fix Scala EitherSerializer duplication |  Critical | API / Scala | Stephan Ewen | Stephan Ewen |
| [FLINK-9635](https://issues.apache.org/jira/browse/FLINK-9635) | Local recovery scheduling can cause spread out of tasks |  Critical | Runtime / Coordination | Till Rohrmann | Stefan Richter |
| [FLINK-10669](https://issues.apache.org/jira/browse/FLINK-10669) | Exceptions & errors are not properly checked in logs in e2e tests |  Major | Test Infrastructure | Dawid Wysakowicz | Dawid Wysakowicz |
| [FLINK-10681](https://issues.apache.org/jira/browse/FLINK-10681) | elasticsearch6.ElasticsearchSinkITCase fails if wrong JNA library installed |  Critical | Connectors / ElasticSearch, Tests | Till Rohrmann | Till Rohrmann |
| [FLINK-10581](https://issues.apache.org/jira/browse/FLINK-10581) | YarnConfigurationITCase.testFlinkContainerMemory test instability |  Critical | Deployment / YARN | Piotr Nowojski | Dawid Wysakowicz |
| [FLINK-10752](https://issues.apache.org/jira/browse/FLINK-10752) | Result of AbstractYarnClusterDescriptor#validateClusterResources is ignored |  Major | Deployment / YARN | Dawid Wysakowicz | Dawid Wysakowicz |
| [FLINK-10715](https://issues.apache.org/jira/browse/FLINK-10715) | E2e tests fail with ConcurrentModificationException in MetricRegistryImpl |  Blocker | Runtime / Metrics, Test Infrastructure | Dawid Wysakowicz | Igal Shilman |
| [FLINK-10357](https://issues.apache.org/jira/browse/FLINK-10357) | Streaming File Sink end-to-end test failed with mismatch |  Critical | Tests | Till Rohrmann | Gary Yao |
| [FLINK-10364](https://issues.apache.org/jira/browse/FLINK-10364) | Test instability in NonHAQueryableStateFsBackendITCase#testMapState |  Critical | Runtime / Queryable State, Tests | Nico Kruber | Stefan Richter |
| [FLINK-10773](https://issues.apache.org/jira/browse/FLINK-10773) | Resume externalized checkpoint end-to-end test fails |  Critical | Test Infrastructure | Till Rohrmann | Till Rohrmann |
| [FLINK-10463](https://issues.apache.org/jira/browse/FLINK-10463) | Null literal cannot be properly parsed in Java Table API function call |  Major | Table SQL / API | Xingcan Cui | Hequn Cheng |
| [FLINK-10750](https://issues.apache.org/jira/browse/FLINK-10750) | SocketClientSinkTest.testRetry fails on Travis |  Critical | Tests | Till Rohrmann | Chesnay Schepler |
| [FLINK-10816](https://issues.apache.org/jira/browse/FLINK-10816) | Fix LockableTypeSerializer.duplicate() |  Major | Library / CEP | Stefan Richter | Stefan Richter |
| [FLINK-10770](https://issues.apache.org/jira/browse/FLINK-10770) | Some generated functions are not opened properly. |  Major | Table SQL / API | wangsan | wangsan |
| [FLINK-10821](https://issues.apache.org/jira/browse/FLINK-10821) | Resuming Externalized Checkpoint E2E test does not resume from Externalized Checkpoint |  Blocker | Test Infrastructure | Gary Yao | Igal Shilman |
| [FLINK-10839](https://issues.apache.org/jira/browse/FLINK-10839) | Fix implementation of PojoSerializer.duplicate() w.r.t. subclass serializer |  Blocker | API / Type Serialization System | Stefan Richter | Stefan Richter |
| [FLINK-10753](https://issues.apache.org/jira/browse/FLINK-10753) | Propagate and log snapshotting exceptions |  Major | Runtime / State Backends | Alexander Fedulov | Stefan Richter |
| [FLINK-10419](https://issues.apache.org/jira/browse/FLINK-10419) | ClassNotFoundException while deserializing user exceptions from checkpointing |  Major | Runtime / Coordination, Runtime / State Backends | Nico Kruber | Dawid Wysakowicz |
| [FLINK-10655](https://issues.apache.org/jira/browse/FLINK-10655) | RemoteRpcInvocation not overwriting ObjectInputStream's ClassNotFoundException |  Major | Runtime / Coordination | Nico Kruber | Nico Kruber |
| [FLINK-10857](https://issues.apache.org/jira/browse/FLINK-10857) | Conflict between JMX and Prometheus Metrics reporter |  Major | Runtime / Metrics | Truong Duc Kien | Chesnay Schepler |
| [FLINK-10856](https://issues.apache.org/jira/browse/FLINK-10856) | Harden resume from externalized checkpoint E2E test |  Critical | Runtime / State Backends, Test Infrastructure | Till Rohrmann | Till Rohrmann |
| [FLINK-10642](https://issues.apache.org/jira/browse/FLINK-10642) | CodeGen split fields errors when maxGeneratedCodeLength equals 1 |  Major | Table SQL / API | xueyu | xueyu |
| [FLINK-10913](https://issues.apache.org/jira/browse/FLINK-10913) | ExecutionGraphRestartTest.testRestartAutomatically unstable on Travis |  Critical | Tests | Till Rohrmann | Till Rohrmann |
| [FLINK-10880](https://issues.apache.org/jira/browse/FLINK-10880) | Failover strategies should not be applied to Batch Execution |  Blocker | Runtime / Coordination | Stephan Ewen | Till Rohrmann |
| [FLINK-10925](https://issues.apache.org/jira/browse/FLINK-10925) | NPE in PythonPlanStreamer |  Major | API / Python | Karel Kolman | Karel Kolman |
| [FLINK-10670](https://issues.apache.org/jira/browse/FLINK-10670) | Fix Correlate codegen error |  Major | Table SQL / API | Ruidong Li | Ruidong Li |
| [FLINK-10481](https://issues.apache.org/jira/browse/FLINK-10481) | Wordcount end-to-end test in docker env unstable |  Critical | Tests | Till Rohrmann | Dawid Wysakowicz |
| [FLINK-10309](https://issues.apache.org/jira/browse/FLINK-10309) | Cancel with savepoint fails with java.net.ConnectException when using the per job-mode |  Critical | Runtime / Coordination, Runtime / REST | vinoyang | Gary Yao |
| [FLINK-10674](https://issues.apache.org/jira/browse/FLINK-10674) | Fix handling of retractions after clean up |  Minor | Table SQL / API | ambition | Timo Walther |
| [FLINK-10998](https://issues.apache.org/jira/browse/FLINK-10998) | flink-metrics-ganglia has LGPL dependency |  Major | Runtime / Metrics | Chesnay Schepler | Chesnay Schepler |
| [FLINK-10990](https://issues.apache.org/jira/browse/FLINK-10990) | Enforce minimum timespan in MeterView |  Minor | Runtime / Metrics | Aitozi | Aitozi |
| [FLINK-10763](https://issues.apache.org/jira/browse/FLINK-10763) | Interval join produces wrong result type in Scala API |  Major | API / DataStream | jinhai | Timo Walther |
| [FLINK-10992](https://issues.apache.org/jira/browse/FLINK-10992) | Jepsen: Do not use /tmp as HDFS Data Directory |  Major | Tests | Gary Yao | Gary Yao |
| [FLINK-11017](https://issues.apache.org/jira/browse/FLINK-11017) | Time interval for window aggregations in SQL is wrongly translated if specified with YEAR\_MONTH resolution |  Major | Table SQL / API | Dawid Wysakowicz | Dawid Wysakowicz |
| [FLINK-10149](https://issues.apache.org/jira/browse/FLINK-10149) | Fink Mesos allocates extra port when not configured to do so |  Minor | Deployment / Mesos | Rune Skou Larsen | Gary Yao |
| [FLINK-10842](https://issues.apache.org/jira/browse/FLINK-10842) | Waiting loops are broken in e2e/common.sh |  Major | Test Infrastructure | Andrey Zagrebin | Andrey Zagrebin |
| [FLINK-10946](https://issues.apache.org/jira/browse/FLINK-10946) | Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis |  Major | Test Infrastructure | Andrey Zagrebin | Andrey Zagrebin |
| [FLINK-11045](https://issues.apache.org/jira/browse/FLINK-11045) | UserCodeClassLoader has not been set correctly for RuntimeUDFContext in CollectionExecutor |  Major | Table SQL / API | Hequn Cheng | Hequn Cheng |
| [FLINK-10997](https://issues.apache.org/jira/browse/FLINK-10997) | Avro-confluent-registry does not bundle any dependency |  Major | Formats (JSON, Avro, Parquet, ORC, SequenceFile), Table SQL / API | Chesnay Schepler | Chesnay Schepler |
| [FLINK-11011](https://issues.apache.org/jira/browse/FLINK-11011) | Elasticsearch 6 sink end-to-end test unstable |  Critical | Test Infrastructure | Timo Walther | Andrey Zagrebin |
| [FLINK-10809](https://issues.apache.org/jira/browse/FLINK-10809) | Using DataStreamUtils.reinterpretAsKeyedStream produces corrupted keyed state after restore |  Major | API / DataStream, Runtime / State Backends | Dawid Wysakowicz | Stefan Richter |
| [FLINK-10482](https://issues.apache.org/jira/browse/FLINK-10482) | java.lang.IllegalArgumentException: Negative number of in progress checkpoints |  Major | Runtime / State Backends | Julio Biason | Andrey Zagrebin |
| [FLINK-11087](https://issues.apache.org/jira/browse/FLINK-11087) | Broadcast state migration Incompatibility from 1.5.3 to 1.7.0 |  Blocker | Runtime / State Backends | Edward Rojas | Tzu-Li (Gordon) Tai |
| [FLINK-11123](https://issues.apache.org/jira/browse/FLINK-11123) | Missing import in ML quickstart docs |  Minor | Documentation, Library / Machine Learning | sunjincheng | sunjincheng |
| [FLINK-11136](https://issues.apache.org/jira/browse/FLINK-11136) | Fix the logical of merge for DISTINCT aggregates |  Major | Table SQL / API | Dian Fu | Dian Fu |
| [FLINK-11083](https://issues.apache.org/jira/browse/FLINK-11083) | CRowSerializerConfigSnapshot is not instantiable |  Major | API / Type Serialization System, Table SQL / API | boshu Zheng | boshu Zheng |


### TESTS:

| JIRA | Summary | Priority | Component | Reporter | Contributor |
|:---- |:---- | :--- |:---- |:---- |:---- |
| [FLINK-10606](https://issues.apache.org/jira/browse/FLINK-10606) | Construct NetworkEnvironment simple for tests |  Minor | Runtime / Network, Tests | Zhijiang | Zhijiang |
| [FLINK-10607](https://issues.apache.org/jira/browse/FLINK-10607) | Unify to remove duplicated NoOpResultPartitionConsumableNotifier |  Minor | Runtime / Network, Tests | Zhijiang | Zhijiang |
| [FLINK-10827](https://issues.apache.org/jira/browse/FLINK-10827) | Add test for duplicate() to SerializerTestBase |  Major | Tests | Stefan Richter | Stefan Richter |


### SUB-TASKS:

| JIRA | Summary | Priority | Component | Reporter | Contributor |
|:---- |:---- | :--- |:---- |:---- |:---- |
| [FLINK-10097](https://issues.apache.org/jira/browse/FLINK-10097) | More tests to increase StreamingFileSink test coverage |  Major | Connectors / FileSystem | Kostas Kloudas | Kostas Kloudas |
| [FLINK-10863](https://issues.apache.org/jira/browse/FLINK-10863) | Assign uids to all operators |  Major | Test Infrastructure | Stefan Richter | Stefan Richter |
| [FLINK-10367](https://issues.apache.org/jira/browse/FLINK-10367) | Avoid recursion stack overflow during releasing SingleInputGate |  Minor | Runtime / Network | Zhijiang | Zhijiang |
| [FLINK-10252](https://issues.apache.org/jira/browse/FLINK-10252) | Handle oversized metric messages |  Critical | Runtime / Metrics | Till Rohrmann | vinoyang |


### OTHER:

| JIRA | Summary | Priority | Component | Reporter | Contributor |
|:---- |:---- | :--- |:---- |:---- |:---- |
| [FLINK-10793](https://issues.apache.org/jira/browse/FLINK-10793) | Change visibility of TtlValue and TtlSerializer to public for external tools |  Major | Runtime / State Backends | Stefan Richter | Stefan Richter |


